# Telegram Anti-Spam Bot Factory

این پروژه یک اسکریپت پایتون است که یک بات تلگرام اصلی (Main Bot) ایجاد می‌کند. این بات به کاربران اجازه می‌دهد بات‌های ضد اسپم اختصاصی برای گروه‌های تلگرام خود بسازند. هر بات ضد اسپم از سیستم CAPTCHA تصویری برای جلوگیری از ورود اسپمرها استفاده می‌کند و فقط در یک گروه کار می‌کند.

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue.svg)](https://www.python.org/) [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ویژگی‌ها
- **ساخت بات اختصاصی**: کاربران می‌توانند با ارائه توکن بات از @BotFather، یک بات ضد اسپم جدید بسازند.
- **سیستم CAPTCHA هوشمند**: CAPTCHA تصویری با اعوجاج، خطوط و نویز برای امنیت بیشتر.
- **مدیریت تلاش‌های ناموفق**: 
  - پس از 3 تلاش اشتباه: بن موقت 1 ساعته.
  - پس از 5 تلاش اشتباه: بن دائم.
- **محدودیت به یک گروه**: بات فقط در اولین گروهی که به آن اضافه می‌شود کار می‌کند و از گروه‌های دیگر خارج می‌شود.
- **ذخیره‌سازی داده‌ها**: استفاده از SQLite برای ذخیره اطلاعات کاربران، تلاش‌ها و تاییدیه‌ها.
- **مانیتورینگ و راه‌اندازی مجدد**: بات‌های ساخته‌شده به صورت subprocess اجرا می‌شوند و در صورت کرش، به طور خودکار راه‌اندازی مجدد می‌شوند.
- **پاک‌سازی خودکار**: پاک‌سازی تاییدیه‌های منقضی‌شده هر 5 دقیقه.
- **دستورات اصلی بات**:
  - `/start`: شروع و ساخت بات.
  - `/mybots`: مشاهده اطلاعات بات ساخته‌شده.
  - `/help`: راهنما.
  - `/cancel`: لغو عملیات.

## پیش‌نیازها
- Python 3.8 یا بالاتر.
- کتابخانه‌های مورد نیاز:
  - `pyTelegramBotAPI` (برای تعامل با API تلگرام).
  - `Pillow` (برای تولید تصاویر CAPTCHA).
- سرور یا محیطی برای اجرای اسکریپت در پس‌زمینه (مانند VPS لینوکس).
- توکن بات اصلی از @BotFather.

## نصب
1. مخزن را کلون کنید:
   ```
   git clone https://github.com/yourusername/telegram-anti-spam-bot-factory.git
   cd telegram-anti-spam-bot-factory
   ```

2. کتابخانه‌ها را نصب کنید:
   ```
   pip install pyTelegramBotAPI Pillow
   ```

3. توکن بات اصلی را در کد جایگزین کنید:
   - در فایل اصلی (مثلاً `main_bot.py`)، مقدار `MAIN_BOT_TOKEN = 'YOUR_MAIN_BOT_TOKEN_HERE'` را با توکن واقعی جایگزین کنید.

4. دایرکتوری‌های لازم را ایجاد کنید (اگر وجود ندارند):
   - `created_bots` برای ذخیره اسکریپت‌های بات‌های ساخته‌شده.

## استفاده
1. اسکریپت را اجرا کنید:
   ```
   nohup python3 main_bot.py > output.log 2>&1 &
   ```
   - این دستور اسکریپت را در پس‌زمینه اجرا می‌کند و خروجی را در `output.log` ذخیره می‌کند.

2. در تلگرام، به بات اصلی پیام دهید و با `/start` شروع کنید.
   - بات راهنمایی می‌کند تا توکن بات جدید را از @BotFather بگیرید و ارسال کنید.
   - بات جدید ساخته می‌شود و دستورالعمل‌های اضافه کردن آن به گروه نمایش داده می‌شود.

3. بات جدید را به گروه اضافه کنید و ادمین کنید (با دسترسی حذف کاربران).
   - بات به طور خودکار گروه را تنظیم می‌کند و اعضای جدید باید CAPTCHA حل کنند.

## پیکربندی
- **فایل‌های دیتابیس**:
  - `bots_manager.db`: برای مدیریت بات‌های ساخته‌شده.
  - `bot_{user_id}.db`: برای هر بات اختصاصی (ذخیره تاییدیه‌ها و تلاش‌ها).
- **تنظیم گروه**: بات جدید فقط در یک گروه کار می‌کند. از دستور `/setgroup` در گروه برای تنظیم دستی استفاده کنید (فقط توسط مالک بات).
- **مانیتورینگ**: یک thread هر 60 ثانیه بات‌های ساخته‌شده را چک می‌کند و در صورت نیاز راه‌اندازی مجدد می‌کند.

## مثال
- کاربر توکن بات را ارسال می‌کند → بات اسکریپت جدید تولید می‌کند → subprocess اجرا می‌شود → بات جدید آماده است.
- عضو جدید به گروه می‌پیوندد → مات می‌شود → لینک تایید به PM بات ارسال می‌شود → CAPTCHA حل می‌شود → دسترسی باز می‌شود.

## مشکلات شناخته‌شده
- اگر فونت "arial.ttf" موجود نباشد، از فونت پیش‌فرض استفاده می‌شود (ممکن است کیفیت CAPTCHA پایین بیاید).
- گروه ID در دیتابیس مدیر به‌روزرسانی نمی‌شود (ویژگی نیمه‌تمام؛ همیشه "تنظیم نشده" نشان می‌دهد).
- اجرای روی ویندوز ممکن است با subprocess مشکل داشته باشد (توصیه: لینوکس).

## مشارکت
- فورک کنید و pull request بفرستید.
- مسائل را در بخش Issues گزارش دهید.

## لایسنس
این پروژه تحت لایسنس MIT منتشر شده است. جزئیات در فایل [LICENSE](LICENSE).
